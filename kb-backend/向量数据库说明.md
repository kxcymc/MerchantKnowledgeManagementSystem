# å‘é‡æ•°æ®åº“å­˜å‚¨ä½ç½®è¯´æ˜

## ğŸ“ å­˜å‚¨ä½ç½®

æ ¹æ®ä½ é…ç½®çš„å­˜å‚¨æ¨¡å¼ï¼Œå‘é‡æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ï¼š

### æ¨¡å¼ 1: JSON æ–‡ä»¶å­˜å‚¨ (`json`)

**å­˜å‚¨ä½ç½®**ï¼š
```
kb-backend/data/vector-store.json
```

**æŸ¥çœ‹æ–¹å¼**ï¼š
- ç›´æ¥æ‰“å¼€ JSON æ–‡ä»¶æŸ¥çœ‹ï¼ˆæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œå»ºè®®ç”¨ç¼–è¾‘å™¨ï¼‰
- ä½¿ç”¨å‘½ä»¤è¡Œï¼š`cat data/vector-store.json` æˆ– `type data\vector-store.json`

**ç‰¹ç‚¹**ï¼š
- å•ä¸ª JSON æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å‘é‡æ•°æ®
- å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘
- æ–‡ä»¶å¤§å°ä¼šéšæ•°æ®å¢é•¿è€Œå¢å¤§

---

### æ¨¡å¼ 2: Chroma æœ¬åœ°æ–‡ä»¶å­˜å‚¨ (`persistent`)

**å­˜å‚¨ä½ç½®**ï¼š
```
kb-backend/data/chroma_db/
```

**æŸ¥çœ‹æ–¹å¼**ï¼š
- è¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«å¤šä¸ªæ•°æ®åº“æ–‡ä»¶
- ä¸èƒ½ç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰
- éœ€è¦é€šè¿‡ Chroma API æŸ¥è¯¢

**ç‰¹ç‚¹**ï¼š
- æ•°æ®åº“æ–‡ä»¶æ ¼å¼ï¼Œä¸èƒ½ç›´æ¥è¯»å–
- éœ€è¦é€šè¿‡ç¨‹åºè®¿é—®

---

### æ¨¡å¼ 3: Chroma æœåŠ¡å™¨æ¨¡å¼ (`server`) - é»˜è®¤

**å­˜å‚¨ä½ç½®**ï¼š
```
kb-backend/data/chroma_server/
```

**æŸ¥çœ‹æ–¹å¼**ï¼š
- é€šè¿‡ Chroma API æŸ¥è¯¢ï¼ˆæ¨èï¼‰
- æ•°æ®åº“æ–‡ä»¶åœ¨æœåŠ¡å™¨å®¹å™¨å†…ï¼Œä¸èƒ½ç›´æ¥æŸ¥çœ‹

**ç‰¹ç‚¹**ï¼š
- æ•°æ®å­˜å‚¨åœ¨ Docker å®¹å™¨çš„æŒä¹…åŒ–ç›®å½•
- éœ€è¦é€šè¿‡ Chroma API è®¿é—®

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹å‘é‡æ•°æ®

### æ–¹æ³• 1: é€šè¿‡ API æŸ¥è¯¢ï¼ˆæ¨èï¼‰

#### 1. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

è®¿é—®ï¼š`http://localhost:3001/health`

è¿”å›ï¼š
```json
{
  "status": "ok",
  "records": 123,  // å‘é‡æ¡ç›®æ€»æ•°
  "queueEnabled": true
}
```

#### 2. æŸ¥çœ‹å‘é‡åˆ—è¡¨

è®¿é—®ï¼š`http://localhost:3001/api/vectors?limit=10`

è¿”å›å‘é‡æ•°æ®åˆ—è¡¨ï¼ˆåŒ…å«æ–‡æœ¬ã€å…ƒæ•°æ®ã€embedding ç­‰ï¼‰

#### 3. æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨

è®¿é—®ï¼š`http://localhost:3001/api/uploads`

è¿”å›æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶åŠå…¶ä¿¡æ¯

---

### æ–¹æ³• 2: é€šè¿‡ Chroma APIï¼ˆä»…é™ server æ¨¡å¼ï¼‰

#### 1. æŸ¥çœ‹é›†åˆä¿¡æ¯

```bash
curl http://localhost:8000/api/v1/collnpm rections/kb_documents
```

#### 2. æŸ¥è¯¢å‘é‡æ•°æ®

```bash
curl -X POST http://localhost:8000/api/v1/collections/kb_documents/query \
  -H "Content-Type: application/json" \
  -d '{"query_texts": ["ä½ çš„æŸ¥è¯¢"], "n_results": 5}'
```

#### 3. è·å–æ‰€æœ‰æ•°æ®

```bash
curl http://localhost:8000/api/v1/collections/kb_documents/get
```

---

### æ–¹æ³• 3: ä½¿ç”¨ Python è„šæœ¬æŸ¥çœ‹ï¼ˆChroma æ¨¡å¼ï¼‰

åˆ›å»ºè„šæœ¬ `scripts/view_vectors.py`ï¼š

```python
import chromadb
from chromadb.config import Settings

# è¿æ¥åˆ° Chroma
client = chromadb.HttpClient(host="localhost", port=8000)

# è·å–é›†åˆ
collection = client.get_collection("kb_documents")

# æŸ¥çœ‹ç»Ÿè®¡
print(f"æ€»æ•°: {collection.count()}")

# è·å–å‰ 10 æ¡
results = collection.get(limit=10)

for i, (id, doc, meta) in enumerate(zip(results['ids'], results['documents'], results['metadatas'])):
    print(f"\n[{i+1}] ID: {id}")
    print(f"    æ–‡æœ¬: {doc[:100]}...")
    print(f"    å…ƒæ•°æ®: {meta}")
```

è¿è¡Œï¼š
```bash
python scripts/view_vectors.py
```

---

## ğŸ“Š å½“å‰é…ç½®æŸ¥çœ‹

æŸ¥çœ‹ä½ çš„ `.env` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```env
VECTOR_STORE_MODE=server  # å½“å‰ä½¿ç”¨çš„æ¨¡å¼
CHROMA_MODE=server        # Chroma æ¨¡å¼
CHROMA_HOST=localhost
CHROMA_PORT=8000
CHROMA_COLLECTION_NAME=kb_documents
```

æ ¹æ®é…ç½®ï¼Œä½ çš„æ•°æ®å­˜å‚¨åœ¨ï¼š
- **Chroma æœåŠ¡å™¨**ï¼ˆ`http://localhost:8000`ï¼‰
- **æŒä¹…åŒ–ç›®å½•**ï¼š`kb-backend/data/chroma_server/`

---

## ğŸ› ï¸ æŸ¥çœ‹å·¥å…·

### 1. æµè§ˆå™¨è®¿é—®

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- http://localhost:3001/health

**å‘é‡åˆ—è¡¨**ï¼š
- http://localhost:3001/api/vectors?limit=25

**ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨**ï¼š
- http://localhost:3001/api/uploads

### 2. Chroma ç®¡ç†ç•Œé¢

è®¿é—® Chroma æœåŠ¡å™¨ï¼š
- http://localhost:8000/api/v1/heartbeat

---

## ğŸ“ å¿«é€ŸæŸ¥çœ‹å‘½ä»¤

### æŸ¥çœ‹ JSON æ¨¡å¼æ•°æ®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

```bash
# Windows
type data\vector-store.json

# Linux/Mac
cat data/vector-store.json | head -100
```

### æŸ¥çœ‹ Chroma æœåŠ¡å™¨æ•°æ®

```bash
# æŸ¥çœ‹é›†åˆæ•°é‡
curl http://localhost:8000/api/v1/collections/kb_documents/count

# æŸ¥çœ‹å‰ 10 æ¡æ•°æ®
curl http://localhost:8000/api/v1/collections/kb_documents/get?limit=10
```

---

## ğŸ” æ•°æ®ä½ç½®æ€»ç»“

| å­˜å‚¨æ¨¡å¼ | å­˜å‚¨ä½ç½® | æŸ¥çœ‹æ–¹å¼ |
|---------|---------|---------|
| `json` | `data/vector-store.json` | ç›´æ¥æŸ¥çœ‹ JSON æ–‡ä»¶ |
| `persistent` | `data/chroma_db/` | é€šè¿‡ Chroma API |
| `server` | `data/chroma_server/` | é€šè¿‡ Chroma API (æ¨è) |

**å½“å‰é»˜è®¤**ï¼š`server` æ¨¡å¼ï¼Œæ•°æ®åœ¨ Chroma æœåŠ¡å™¨ä¸­ã€‚

---

## ğŸ’¡ å»ºè®®

- **å¼€å‘/æµ‹è¯•**ï¼šä½¿ç”¨ `json` æ¨¡å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ•°æ®
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ `server` æ¨¡å¼ï¼Œæ€§èƒ½æ›´å¥½
- **æŸ¥çœ‹æ•°æ®**ï¼šä¼˜å…ˆä½¿ç”¨ API æ¥å£ï¼Œä¸è¦ç›´æ¥æ“ä½œæ•°æ®æ–‡ä»¶

