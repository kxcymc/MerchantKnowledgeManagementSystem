services:
  chromadb:
    image: chromadb/chroma:latest
    container_name: chroma-server
    ports:
      - "8000:8000"
    volumes:
      # 持久化数据到本地目录，即使容器删除数据也不会丢失
      # 注意：Chroma 服务器将数据存储在容器内的 /data 目录（不是 /chroma/chroma）
      # Windows 上使用绝对路径确保卷映射正常工作
      # 路径格式：Windows路径(正斜杠):容器内路径
      # - F:/字节训练营/kb-backend/data/chroma_server:/data
      - /Users/gardenia/Desktop/MerchantKnowledgeManagementSystem/kb-backend/data/chroma_server:/data
    environment:
      # 启用持久化存储
      - IS_PERSISTENT=TRUE
      # 禁用匿名遥测
      - ANONYMIZED_TELEMETRY=FALSE
      # Chroma 数据目录环境变量（明确指定）
      - CHROMA_SERVER_AUTH_CREDENTIALS=
      - CHROMA_SERVER_AUTH_TOKEN_TRANSPORT_HEADER=
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v2/heartbeat"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - kb-network

networks:
  kb-network:
    driver: bridge

