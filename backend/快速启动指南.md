# åç«¯æœåŠ¡å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æ–‡æ¡£æä¾›åç«¯æœåŠ¡çš„å®Œæ•´å¯åŠ¨æµç¨‹ï¼ŒåŒ…æ‹¬ä¾èµ–æœåŠ¡å¯åŠ¨ã€æ•°æ®åº“åˆå§‹åŒ–å’ŒæœåŠ¡å¯åŠ¨ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

- **Node.js** >= 16.0.0
- **Docker** å’Œ **Docker Compose**ï¼ˆç”¨äº Chroma å‘é‡æ•°æ®åº“ï¼‰
- **MySQL** >= 5.7 æˆ– >= 8.0
- **RabbitMQ**ï¼ˆå¯é€‰ï¼Œç”¨äºå¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼‰

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ä¾èµ–æœåŠ¡

é¦–æ¬¡å¯åŠ¨å‰ï¼Œéœ€è¦å…ˆå¯åŠ¨ä»¥ä¸‹ä¾èµ–æœåŠ¡ï¼š

#### 1.1 å¯åŠ¨ MySQL æ•°æ®åº“

**Windows:**
```powershell
# æ–¹å¼1ï¼šé€šè¿‡æœåŠ¡ç®¡ç†å™¨å¯åŠ¨
net start MySQL84  

# æ–¹å¼2ï¼šé€šè¿‡æœåŠ¡ç®¡ç†å™¨ GUI
# Win + R -> services.msc -> æ‰¾åˆ° MySQL æœåŠ¡ -> å¯åŠ¨
```

**Linux/Mac:**
```bash
sudo systemctl start mysql
# æˆ–
sudo service mysql start
```

**éªŒè¯ MySQL è¿æ¥:**
```bash
mysql -h localhost -u KBase -p
# è¾“å…¥å¯†ç åï¼Œåˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
CREATE DATABASE IF NOT EXISTS kb_database;
```

#### 1.2 å¯åŠ¨ Chroma å‘é‡æ•°æ®åº“ï¼ˆDockerï¼‰

```bash
# è¿›å…¥ kb-backend ç›®å½•
cd kb-backend

# å¯åŠ¨ Chroma æœåŠ¡
docker-compose up -d

# éªŒè¯ Chroma æ˜¯å¦å¯åŠ¨æˆåŠŸ
docker ps | findstr chroma  # Windows
# æˆ–
docker ps | grep chroma     # Linux/Mac

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8000/api/v2/heartbeat
```

**åœæ­¢ Chroma:**
```bash
docker-compose down
```

#### 1.3 å¯åŠ¨ RabbitMQï¼ˆå¯é€‰ï¼‰

> **æ³¨æ„ï¼š** RabbitMQ æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

**Windowsï¼ˆä½¿ç”¨è„šæœ¬ï¼‰:**
```powershell
# è¿›å…¥ kb-backend/scripts ç›®å½•
cd kb-backend\scripts

# å¯åŠ¨ RabbitMQï¼ˆéœ€è¦å…ˆé…ç½®è„šæœ¬ä¸­çš„è·¯å¾„ï¼‰
.\RabbitMQ_start.ps1
```

**Windowsï¼ˆæ‰‹åŠ¨å¯åŠ¨ï¼‰:**
```powershell
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ ¹æ®ä½ çš„å®é™…å®‰è£…è·¯å¾„è°ƒæ•´ï¼‰
$env:ERLANG_HOME = "E:\Tools\Erlang OTP"
$env:RABBITMQ_HOME = "E:\Tools\RabbitMQ\rabbitmq_server-4.1.5"
$env:PATH = "$env:ERLANG_HOME\bin;$env:PATH"

# å¯åŠ¨ RabbitMQ
cd $env:RABBITMQ_HOME\sbin
.\rabbitmq-server.bat
```

**Linux/Mac:**
```bash
sudo systemctl start rabbitmq-server
# æˆ–
sudo service rabbitmq-server start
```

**éªŒè¯ RabbitMQ:**
- ç®¡ç†ç•Œé¢: http://localhost:15672ï¼ˆé»˜è®¤ç”¨æˆ·å/å¯†ç : guest/guestï¼‰
- æ£€æŸ¥ç«¯å£: `netstat -an | findstr 5672` (Windows) æˆ– `netstat -an | grep 5672` (Linux/Mac)

**åœæ­¢ RabbitMQ:**
```powershell
# Windowsï¼ˆä½¿ç”¨è„šæœ¬ï¼‰
cd kb-backend\scripts
.\RabbitMQ_stop.ps1

# Linux/Mac
sudo systemctl stop rabbitmq-server
```

---

### ç¬¬äºŒæ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

#### 2.1 é…ç½®æ ¹ç›®å½•ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
# åœ¨ backend æ ¹ç›®å½•
cp env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š
```

**å¿…å¡«é…ç½®:**
- `DASHSCOPE_API_KEY`: é˜¿é‡Œäº‘ DashScope API Key
  - è·å–æ–¹å¼: https://dashscope.console.aliyun.com/apiKey
- `MYSQL_HOST`: MySQL æœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤: localhostï¼‰
- `MYSQL_PORT`: MySQL ç«¯å£ï¼ˆé»˜è®¤: 3306ï¼‰
- `MYSQL_USER`: MySQL ç”¨æˆ·åï¼ˆé»˜è®¤: KBaseï¼‰
- `MYSQL_PASSWORD`: MySQL å¯†ç 
- `MYSQL_DATABASE`: MySQL æ•°æ®åº“åï¼ˆé»˜è®¤: kb_databaseï¼‰

**å¯é€‰é…ç½®:**
- `RABBIT_URL`: RabbitMQ è¿æ¥åœ°å€ï¼ˆé»˜è®¤: amqp://localhostï¼‰
- `CHROMA_HOST`: Chroma æœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤: localhostï¼‰
- `CHROMA_PORT`: Chroma æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤: 8000ï¼‰

#### 2.2 é…ç½®å­é¡¹ç›®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åœ¨å­é¡¹ç›®ä¸­å•ç‹¬é…ç½®ï¼Œå¯ä»¥ï¼š

```bash
# kb-backend
cd kb-backend
cp env.example .env
# ç¼–è¾‘ .env

# qa-chatbot-backend
cd qa-chatbot-backend
cp env.example .env
# ç¼–è¾‘ .env
```

---

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ï¼ˆé¦–æ¬¡æ­å»ºå¿…åšï¼‰

**é¦–æ¬¡æ­å»ºæ—¶ï¼Œéœ€è¦åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„ï¼š**

```bash
# åœ¨ backend æ ¹ç›®å½•æ‰§è¡Œ

# æ–¹å¼1ï¼šåˆå§‹åŒ–æ‰€æœ‰è¡¨ï¼ˆæ¨èï¼‰
npm run init-db

# æ–¹å¼2ï¼šåˆ†åˆ«åˆå§‹åŒ–
npm run init-db:kb    # åªåˆå§‹åŒ– kb-backend ç›¸å…³è¡¨
npm run init-db:qa    # åªåˆå§‹åŒ– qa-chatbot-backend ç›¸å…³è¡¨
```

**è¯´æ˜:**
- `init-db:kb` ä¼šåˆ›å»º `Knowledge` å’Œ `BusinessScene` è¡¨
- `init-db:qa` ä¼šåˆ›å»ºä¼šè¯ã€æ¶ˆæ¯ã€å¼•ç”¨ç­‰ç›¸å…³è¡¨
- å¦‚æœä¸¤ä¸ªæœåŠ¡éƒ½éœ€è¦ï¼Œå»ºè®®ä½¿ç”¨ `init-db` ä¸€æ¬¡æ€§åˆå§‹åŒ–æ‰€æœ‰è¡¨

---

### ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# åœ¨ backend æ ¹ç›®å½•æ‰§è¡Œ

# æ–¹å¼1ï¼šä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆæ¨èï¼‰
npm run install:all

# æ–¹å¼2ï¼šåˆ†åˆ«å®‰è£…
npm install                    # å®‰è£…æ ¹ç›®å½•ä¾èµ–
cd kb-backend && npm install   # å®‰è£… kb-backend ä¾èµ–
cd ../qa-chatbot-backend && npm install  # å®‰è£… qa-chatbot-backend ä¾èµ–
```

---

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

ä½¿ç”¨ `package.json` ä¸­çš„å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š

#### 5.1 å¯åŠ¨å•ä¸ªæœåŠ¡

```bash
# å¯åŠ¨ kb-backendï¼ˆçŸ¥è¯†åº“ç®¡ç†æœåŠ¡ï¼Œç«¯å£ 3001ï¼‰
npm run kb:start
# æˆ–
npm run kb:dev    # å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰

# å¯åŠ¨ qa-chatbot-backendï¼ˆé—®ç­”èŠå¤©æœåŠ¡ï¼Œç«¯å£ 3002ï¼‰
npm run qa:start
# æˆ–
npm run qa:dev    # å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
```

#### 5.2 åŒæ—¶å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# ç”Ÿäº§æ¨¡å¼
npm start

# å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼Œæ”¯æŒè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

**è¯´æ˜:**
- `npm start` ä¼šåŒæ—¶å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ï¼Œä½¿ç”¨ `concurrently` ç®¡ç†
- `npm run dev` æ˜¯å¼€å‘æ¨¡å¼ï¼Œæ”¯æŒä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡å¯
- æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ä¸åŒé¢œè‰²çš„æ—¥å¿—è¾“å‡º

#### 5.3 å¯åŠ¨ RabbitMQ Workerï¼ˆå¦‚æœå¯ç”¨äº† RabbitMQï¼‰

å¦‚æœé…ç½®äº† RabbitMQï¼Œéœ€è¦é¢å¤–å¯åŠ¨ Worker è¿›ç¨‹å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼š



### æ£€æŸ¥æœåŠ¡çŠ¶æ€

1. **kb-backend (ç«¯å£ 3001)**
   ```bash
   curl http://localhost:3001/api/health
   # æˆ–æµè§ˆå™¨è®¿é—®: http://localhost:3001
   ```

2. **qa-chatbot-backend (ç«¯å£ 3002)**
   ```bash
   curl http://localhost:3002/api/health
   # æˆ–æµè§ˆå™¨è®¿é—®: http://localhost:3002
   ```

3. **Chroma (ç«¯å£ 8000)**
   ```bash
   curl http://localhost:8000/api/v2/heartbeat
   ```

4. **RabbitMQ (ç«¯å£ 5672)**
   ```bash
   # æµè§ˆå™¨è®¿é—®ç®¡ç†ç•Œé¢
   http://localhost:15672
   ```

### æ£€æŸ¥æ—¥å¿—

å¯åŠ¨æˆåŠŸåï¼Œæ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š
- âœ… MySQL æ•°æ®åº“è¿æ¥æˆåŠŸ
- âœ… Chroma å‘é‡æ•°æ®åº“è¿æ¥æˆåŠŸ
- âœ… æœåŠ¡å¯åŠ¨åœ¨æŒ‡å®šç«¯å£

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### ä¾èµ–æœåŠ¡ç®¡ç†

```bash
# MySQL
net start MySQL80              # Windows å¯åŠ¨
sudo systemctl start mysql     # Linux/Mac å¯åŠ¨

# Chroma
cd kb-backend
docker-compose up -d           # å¯åŠ¨
docker-compose down            # åœæ­¢
docker-compose logs -f         # æŸ¥çœ‹æ—¥å¿—

# RabbitMQ
cd kb-backend\scripts
.\RabbitMQ_start.ps1           # Windows å¯åŠ¨
.\RabbitMQ_stop.ps1            # Windows åœæ­¢
sudo systemctl start rabbitmq-server  # Linux/Mac å¯åŠ¨
```

### æ•°æ®åº“ç®¡ç†

```bash
# åˆå§‹åŒ–æ•°æ®åº“
npm run init-db                # åˆå§‹åŒ–æ‰€æœ‰è¡¨
npm run init-db:kb             # åªåˆå§‹åŒ– kb-backend è¡¨
npm run init-db:qa             # åªåˆå§‹åŒ– qa-chatbot-backend è¡¨
```

### æœåŠ¡å¯åŠ¨

```bash
# å•ä¸ªæœåŠ¡
npm run kb:start               # å¯åŠ¨ kb-backend
npm run kb:dev                 # å¼€å‘æ¨¡å¼å¯åŠ¨ kb-backend
npm run qa:start               # å¯åŠ¨ qa-chatbot-backend
npm run qa:dev                 # å¼€å‘æ¨¡å¼å¯åŠ¨ qa-chatbot-backend

# åŒæ—¶å¯åŠ¨
npm start                      # ç”Ÿäº§æ¨¡å¼å¯åŠ¨æ‰€æœ‰æœåŠ¡
npm run dev                    # å¼€å‘æ¨¡å¼å¯åŠ¨æ‰€æœ‰æœåŠ¡


## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - åç«¯æœåŠ¡è¯¦ç»†è¯´æ˜
- [kb-backend/README.md](./kb-backend/README.md) - çŸ¥è¯†åº“åç«¯è¯¦ç»†æ–‡æ¡£
- [qa-chatbot-backend/README.md](./qa-chatbot-backend/README.md) - é—®ç­”èŠå¤©åç«¯è¯¦ç»†æ–‡æ¡£

---
