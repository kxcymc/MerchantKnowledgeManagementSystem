services:
  chromadb:
    image: chromadb/chroma:latest
    container_name: chroma-server
    ports:
      - "8000:8000"
    volumes:
      # 持久化数据到本地目录，即使容器删除数据也不会丢失
      # 默认使用相对路径，跨平台更兼容；如需绝对路径请按需替换
      - ./data/chroma_server:/data
      # Windows 绝对路径示例（按需启用）：
      # - G:/bytedance_camp/MerchantKnowledgeManagementSystem/backend/kb-backend/data/chroma_server:/data
      # macOS 绝对路径示例（按需启用）：
      # - /Users/xxx/MerchantKnowledgeManagementSystem/backend/kb-backend/data/chroma_server:/data
    environment:
      # 启用持久化存储
      - IS_PERSISTENT=TRUE
      # 明确指定持久化目录
      - PERSIST_DIRECTORY=/data
      # 禁用匿名遥测
      - ANONYMIZED_TELEMETRY=FALSE
      # Chroma 数据目录环境变量（明确指定）
      - CHROMA_SERVER_AUTH_CREDENTIALS=
      - CHROMA_SERVER_AUTH_TOKEN_TRANSPORT_HEADER=
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v2/heartbeat"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - kb-network

networks:
  kb-network:
    driver: bridge

